package dev.benedikt.compression.sixpack

import dev.benedikt.compression.sixpack.rework.SixpackCompressor
import dev.benedikt.compression.sixpack.rework.SixpackDecompressor
import java.nio.ByteBuffer

open class SixpackDecompressor(config: SixpackConfig) : SixpackBase(config) {

  private var buffer = IntArray(0)
  private var bufferPosition = 0

  private var inputBitBuffer = 0
  private var inputBitCount = 0

  private var inputBuffer: ByteBuffer? = null

  override fun init() {
    super.init()

    this.inputBitBuffer = 0
    this.inputBitCount = 0

    this.buffer = IntArray(this.maxSize)
    this.bufferPosition = 0
  }

  /**
   * Decompress the given data into a byte array.
   *
   * @param buffer The bytes to decompress
   */
  fun decompress(buffer: ByteBuffer): ByteArray {
    // Initialize the compression data.
    this.init()

    // Save the input stream (converting it to unsigned byte values).
    this.inputBuffer = buffer

    val outputStream = mutableListOf<Int>()

    while (true) {
      val code = this.decompressCode() ?: break

      if (code < 256) {
        // The first 256 characters are unchanged.
        outputStream.add(code)
        this.buffer[this.bufferPosition++] = code
        if (this.bufferPosition >= this.maxSize) this.bufferPosition = 0
        continue
      }

      val index = (code - this.config.firstCode) / this.config.codesPerRange
      val length = code - this.config.firstCode + this.config.minCopy - index * this.config.codesPerRange

      val inputCode = this.getInputCode(this.config.copyBits[index]) ?: break
      val dist = inputCode + length + this.copyMin[index]

      var j = this.bufferPosition
      var k = this.bufferPosition - dist

      if (k < 0) {
        k += this.maxSize
      }

      for (i in 0 until length) {
        outputStream.add(this.buffer[k])
        this.buffer[j++] = this.buffer[k++]
        if (j >= this.maxSize) j = 0
        if (k >= this.maxSize) k = 0
      }

      this.bufferPosition += length
      if (this.bufferPosition >= this.maxSize) this.bufferPosition -= this.maxSize
    }

    return outputStream.map { it.toByte() }.toByteArray()
  }

  /**
   * Decompress the next character value from the input stream.
   *
   * @return the decompressed value. `null` if there is none left.
   */
  private fun decompressCode(): Int? {
    var code = this.config.root

    do {
      val bit = this.readBit() ?: return null
      code = if (bit) this.rightCode[code] else this.leftCode[code]
    } while (code <= this.config.maxChar)

    code -= this.config.successMax
    this.updateHuffmanModel(code)
    return code
  }

  private fun getInputCode(bits: Int): Int? {
    var mask = 1
    var code = 0

    for (i in 0 until bits) {
      val bit = this.readBit() ?: return null
      if (bit) {
        code = code or mask
      }
      mask = code shl 1
    }

    return code
  }

  /**
   * Get the next bit from the input stream.
   *
   * @return The bit value. `null` if there is none left.
   */
  private fun readBit(): Boolean? {
    if (this.inputBitCount-- <= 0) {
      this.inputBitBuffer = this.readByte() ?: return null
      if (this.inputBitBuffer == this.config.terminationCode) return null
      this.inputBitCount = 7
    }

    val masked = this.inputBitBuffer and 128
    val bit = masked != 0
    this.inputBitBuffer = this.inputBitBuffer shl 1 and 255
    println(bit)
    return bit
  }

  /**
   * Read the next byte from the input stream.
   *
   * @return the byte read.
   */
  private fun readByte(): Int? {
    if (!inputBuffer!!.hasRemaining()) return null
    // Convert the signed byte to a unsigned one for easier processing.
    return inputBuffer!!.get().toInt() and 0xff
  }
}

fun main(args: Array<String>) {
  val data = intArrayOf(172,206,250,50,95,236,75,73,28,197,179,32,237,204,110,157,210,27,32,99,254,244,251,127,192,155,254,39,120,159,80,133,48,122,159,163,211,19,92,43,244,166,235,175,223,166,29,22,55,22,231,231,85,203,21,152,244,185,211,140,140,236,36,235,67,226,205,22,246,114,84,212,62,247,24,231,205,92,26,6,162,60,15,176,14,242,38,99,41,125,85,144,58,92,34,2,79,144,36,38,123,109,185,90,84,232,234,38,231,186,95,72,196,143,143,120,10,215,44,208,125,121,245,121,226,16,64,39,57,147,190,160,159,33,37,1,191,96,38,224,198,158,116,213,88,53,119,117,209,110,72,9,166,232,27,129,215,72,188,163,10,184,101,250,85,193,106,178,232,140,206,203,52,225,22,231,152,219,193,8,69,170,14,136,166,34,175,4,50,168,155,3,189,7,84,7,122,30,77,158,211,97,249,70,106,126,30,137,76,158,36,241,58,128,198,237,245,208,216,58,233,167,255,195,131,78,254,80,226,103,102,163,213,203,209,78,85,204,10,159,115,156,211,255,219,9,183,133,27,107,78,150,155,91,84,94,110,235,25,168,219,39,14,207,211,40,76,240,142,247,237,70,197,142,150,55,109,161,115,91,172,96,133,17,130,18,65,23,95,106,251,179,190,117,206,237,255,213,30,127,249,213,4,221,30,213,58,188,202,131,190,13,12,127,28,153,155,176,28,205,6,208,114,37,104,141,114,155,191,245,77,73,146,78,184,218,76,103,139,234,152,177,109,89,239,197,61,158,103,173,187,115,80,167,0,47,205,119,48,23,129,11,69,103,2,214,50,90,178,209,60,219,76,101,140,211,33,198,105,234,122,0,189,96,196,52,35,77,121,38,131,18,237,87,40,255,213,172,156,215,214,228,201,125,221,97,255,132,253,67,143,70,126,163,207,163,245,34,129,246,35,229,122,206,76,6,104,245,15,139,108,42,201,89,244,131,236,80,82,157,72,139,114,20,213,24,104,74,15,134,157,51,118,17,177,179,161,95,110,229,92,170,39,194,133,246,233,140,155,190,4,28,165,16,4,96,211,209,9,29,223,232,230,102,70,28,184,114,244,100,202,134,2,97,100,22,4,203,57,80,152,228,119,38,21,130,94,243,76,59,177,158,152,22,178,10,106,137,240,173,115,90,118,77,111,162,115,167,140,33,210,155,43,71,63,230,14,122,217,254,162,164,36,101,143,8,29,236,83,230,186,236,83,207,153,167,153,125,246,137,25,142,239,160,114,185,189,26,76,111,89,101,41,82,153,226,9,85,150,134,43,43,133,73,240,32,86,55,110,248,18,216,38,149,22,221,51,255,129,157,115,182,139,133,76,252,43,16,221,173,248,74,68,34,82,3,81,215,168,81,1,215,200,25,80,200,13,218,210,216,107,51,109,49,155,233,144,217,166,121,155,121,214,152,115,164,24,46,16,102,237,210,216,110,109,180,195,111,166,4,137,252,202,136,186,10,102,248,41,151,32,124,184,182,211,150,250,232,52,90,112,56,103,204,196,31,82,0,84,34,111,125,23,151,203,109,114,223,92,46,156,217,243,58,55,194,80,132,222,59,112,180,78,42,116,195,78,13,62,112,194,43,180,45,126,183,11,63,69,118,131,180,114,84,13,191,177,238,79,103,254,178,130,189,114,211,61,196,239,237,31,228,119,211,123,42,55,213,53,99,41,36,124,66,247,88,139,111,55,217,81,188,181,171,59,176,113,79,54,45,77,33,180,51,64,98,25,183,17,12,218,68,6,109,242,3,51,114,70,109,226,55,19,32,60,82,198,132,12,57,19,76,34,81,32,60,34,142,73,76,87,184,98,182,218,46,189,73,240,129,76,148,205,223,4,213,86,55,14,218,8,170,241,210,83,42,203,207,132,24,201,121,173,240,73,85,99,112,31,160,211,58,57,243,107,133,101,9,40,189,46,145,43,235,31,25,63,90,163,15,253,236,148,56,240,75,168,255,174,237,82,15,169,100,137,246,29,70,200,168,162,50,223,37,100,111,233,89,19,65,99,115,108,174,54,234,228,137,88,125,246,66,150,128,178,134,83,224,21,28,198,149,185,163,132,45,209,109,121,236,226,255,159,99,172,243,233,101,111,53,94,218,234,156,225,111,246,250,197,191,169,89,70,58,11,115,79,178,209,202,41,79,220,226,161,252,251,143,2,122,148,210,74,59,175,124,140,127,81,163,195,158,131,238,65,209,58,178,89,253,190,169,161,253,10,160,108,43,111,144,77,228,245,14,166,150,107,236,182,250,216,222,235,182,136,201,255,202,253,125,31,16,159,159,250,153,206,58,229,250,157,230,223,73,215,238,212,81,6,255,250,87,170,122,17,171,211,255,109,92,237,201,126,206,147,111,215,222,126,210,250,40,223,253,43,255,56,13,206,147,250,239,159,58,146,240,135,214,63,52,94,210,180,205,229,254,149,251,12,96,134,159,255,222,235,155,228,57,248,168,184,206,254,78,231,33,204,107,168,227,59,253,27,129,54,28,158,200,194,84,253,85,194,126,190,95,189,202,195,209,162,252,75,9,166,255,96,157,230,78,191,31,252,75,37,24,151,246,197,208,221,241,171,189,135,110,5,23,32,175,26,184,103,127,129,104,42,89,192,125,255,170,243,4,249,255,102,192,193,108,125,66,224,155,31,210,218,8,56,253,215,7,177,254,26,195,7,71,221,176,15,216,126,155,16,246,63,229,3,90,125,173,134,11,174,18,188,54,195,151,79,13,105,201,42,24,43,220,226,32,254,234,118,96,23,126,202,141,67,144,219,65,249,144,204,82,134,167,237,144,243,97,129,8,94,188,192,46,239,218,19,91,14,137,212,33,52,63,6,216,156,250,245,91,17,54,175,198,200,154,208,234,187,132,143,92,33,240,38,180,57,13,227,38,131,152,232,113,232,68,104,199,234,202,21,58,239,177,48,246,167,252,183,233,242,91,255,251,252,228,70,22,143,211,71,63,206,229,230,149,255,84,255,218,39,58,117,153,181,171,228,159,208,84,15,57,255,170,123,117,158,99,97,128,47,155,89,24,178,14,143,28,234,124,193,233,60,7,227,255,46,132,168,247,101,98,92,108,92,85,125,168,7,151,88,199,183,125,172,248,50,109,245,182,254,189,253,48,109,186,171,87,153,167,68,125,169,60,188,65,244,133,172,85,78,158,102,197,71,252,111,187,196,91,87,126,251,175,116,107,148,68,62,70,251,131,243,20,111,80,169,100,107,150,32,114,48,234,170,210,48,121,203,224,195,161,3,92,96,243,10,157,6,2,230,21,31,240,244,255,16,122,122,136,95,46,21,131,246,50,111,90,207,199,124,132,200,48,175,231,77,78,188,65,171,181,102,192,197,181,212,63,44,97,97,253,111,36,36,109,223,21,182,59,192,214,246,173,90,24,222,190,255,182,117,5,247,96,237,204,35,121,246,253,111,136,11,186,133,15,46,209,173,24,199,55,80,166,189,123,149,188,250,131,56,252,65,223,94,205,64,49,120,129,200,237,21,119,9,24,171,115,130,142,63,49,237,115,254,137,120,93,138,218,216,20,113,196,149,2,236,76,42,133,198,86,191,226,7,47,106,15,120,199,251,172,7,214,20,231,224,29,254,40,127,112,168,138,214,103,198,179,96,113,253,241,80,82,192,151,244,184,5,216,188,83,202,141,192,247,32,108,235,82,208,189,21,149,45,8,142,71,136,251,74,150,140,16,199,241,70,61,194,162,0,180,101,247,245,171,67,171,237,241,81,114,43,243,88,95,107,204,123,245,137,182,239,94,183,230,179,55,39,197,22,224,141,224,157,247,138,115,138,46,36,78,249,226,159,96,93,144,95,221,226,39,187,237,140,63,182,183,187,68,195,197,37,248,63,155,144,197,219,62,255,197,123,23,231,104,58,199,93,110,21,178,181,71,22,234,139,163,219,119,226,99,174,124,113,111,181,51,202,44,230,252,76,20,240,98,53,141,20,89,207,119,5,60,95,19,92,227,177,59,118,140,99,154,9,237,20,113,75,216,191,19,44,230,10,120,190,38,251,98,122,220,14,236,12,198,118,122,6,98,20,212,128,230,234,22,123,246,17,59,184,30,32,223,120,118,127,192,169,158,183,120,154,183,224,67,250,94,3,250,247,1,15,250,219,23,118,185,180,14,225,116,72,63,168,33,249,80,185,206,110,188,28,142,208,110,73,161,62,37,61,128,117,92,38,123,66,119,255,192,48,241,251,237,136,202,248,186,252,51,120,25,251,199,163,127,20,180,99,55,139,162,77,109,82,228,13,188,114,13,251,196,203,29,86,44,56,142,211,26,231,136,162,112,216,151,159,4,64,218,118,252,6,184,64,157,97,191,5,77,225,109,46,4,105,208,24,192,199,192,28,166,22,43,80,63,174,39,252,21,50,181,106,139,129,113,85,214,55,198,23,182,37,237,199,119,130,215,31,230,211,11,86,181,22,224,167,87,151,94,250,175,21,14,218,130,105,31,35,183,118,195,190,203,138,203,71,97,200,193,95,218,23,79,9,175,249,117,187,133,97,8,117,205,115,155,233,153,178,152,91,192,60,32,244,232,54,16,141,112,95,82,23,222,11,249,8,124,53,174,195,95,241,150,125,25,175,25,53,3,78,161,133,248,199,98,49,223,30,121,25,83,176,205,230,51,247,142,250,195,143,126,127,136,246,62,236,124,181,95,7,143,74,191,77,10,205,248,144,157,72,194,252,197,236,180,206,134,47,7,164,191,18,102,188,59,235,31,119,203,66,145,240,183,138,180,47,157,157,71,90,249,104,89,104,111,157,157,187,54,43,249,190,155,19,235,8,208,216,95,193,233,44,31,88,61,77,133,248,67,229,131,234,23,164,176,191,51,94,176,125,153,111,232,57,226,61,149,51,120,63,173,111,184,213,213,102,252,100,243,101,246,49,94,179,126,59,235,89,125,143,241,85,122,218,56,84,59,126,191,123,71,10,150,227,77,44,28,70,154,71,110,254,174,231,221,245,186,140,57,210,232,191,116,74,245,190,45,47,250,192,235,171,243,132,70,118,198,28,198,117,214,248,177,111,150,7,93,246,238,159,183,93,96,215,211,62,151,88,248,99,86,178,108,253,214,126,215,7,75,103,191,93,109,229,69,177,130,198,167,196,233,219,24,117,20,26,150,248,161,67,157,129,192,111,103,96,215,99,250,167,94,183,150,249,139,214,153,208,123,215,163,175,7,130,46,208,131,193,74,197,78,219,117,155,80,201,55,71,165,4,231,172,67,180,222,115,23,170,156,208,240,245,211,235,253,53,86,184,108,245,208,184,142,155,47,35,98,70,17,67,36,245,211,228,250,98,53,33,119,125,105,54,196,247,91,7,222,115,214,239,99,49,116,34,72,61,233,11,32,96,149,182,6,8,55,100,237,183,61,142,3,246,40,148,204,92,37,221,129,238,17,178,3,204,77,236,7,152,49,106,23,112,46,173,179,158,189,52,156,161,53,215,95,129,22,204,246,38,167,100,67,181,30,226,123,42,197,130,103,213,215,224,127,83,61,137,172,251,250,106,119,140,84,233,167,209,61,106,182,225,53,214,47,166,174,171,124,80,33,100,77,240,178,78,137,174,54,246,233,190,100,29,195,152,205,123,141,183,252,79,101,116,116,17,108,200,83,198,17,134,8,88,98,37,205,185,113,147,248,12,73,91,48,37,1,254,153,50,56,206,245,192,139,57,133,236,123,79,117,112,66,226,142,249,150,90,18,178,38,187,152,207,127,136,71,249,168,128,140,49,61,144,91,156,65,127,129,254,242,7,112,227,123,238,49,120,186,58,48,189,3,193,46,39,181,253,172,121,110,138,146,6,18,212,88,125,140,149,228,48,150,184,212,61,227,59,139,163,163,87,227,203,119,26,25,198,15,107,163,163,23,129,224,151,198,169,242,48,115,7,249,168,31,10,169,230,48,191,15,135,94,63,251,141,159,64,242,18,49,160,52,246,228,54,241,198,41,188,52,116,13,74,216,110,16,82,97,119,191,15,91,164,62,134,37,169,91,17,16,34,13,204,65,11,9,237,162,10,176,18,47,2,2,192,42,245,136,4,0,182,136,228,32,189,192,6,131,184,12,184,65,40,19,208,43,168,250,40,115,181,215,241,189,45,66,53,213,61,175,13,170,190,125,245,233,174,175,157,246,134,197,150,189,109,113,61,69,243,89,107,170,117,240,101,128,174,238,1,97,99,250,143,17,192,94,200,31,158,122,208,70,114,143,16,64,31,212,203,127,19,245,78,96,127,88,203,184,127,218,16,140,127,245,103,181,139,26,125,52,149,17,240,78,131,170,182,24,117,69,110,232,159,212,50,204,132,116,90,1,126,170,59,0,36,180,224,53,198,224,225,179,140,8,180,136,100,177,150,111,25,46,149,206,30,215,59,71,42,111,62,54,211,254,66,103,191,225,93,123,142,6,110,175,198,148,190,8,176,241,153,15,73,139,90,216,223,91,144,212,212,227,108,116,53,229,97,196,132,1,88,101,246,209,49,204,8,158,211,79,179,110,105,99,221,182,87,201,147,119,175,241,101,244,174,192,246,175,207,135,197,94,223,40,237,209,208,103,49,175,210,107,60,33,201,55,95,245,105,215,42,209,194,174,209,244,145,239,251,27,67,139,1,199,194,148,119,175,243,215,104,113,111,62,119,252,255,219,238,185,185,119,182,59,231,61,105,186,160,222,84,113,63,76,96,121,106,110,69,93,71,232,74,7,21,249,230,229,237,251,188,247,115,248,243,94,185,252,185,187,231,116,125,210,191,53,186,174,202,254,250,218,221,65,95,187,239,169,171,168,210,238,51,188,254,33,216,117,221,89,71,20,63,191,243,239,36,48,239,239,119,121,253,146,165,159,195,142,149,175,207,181,45,213,6,28,19,87,255,16,139,143,159,207,226,123,255,180,124,220,168,53,14,75,75,229,117,33,60,60,245,231,246,246,241,225,231,199,9,127,121,238,196,216,40,85,143,159,69,218,80,14,99,249,253,103,231,80,149,240,242,177,211,137,159,194,139,181,137,74,194,165,144,121,46,14,9,249,180,174,127,130,151,7,168,12,77,113,136,231,102,2,98,249,214,133,157,218,85,137,17,38,182,231,222,123,90,141,117,171,38,65,11,5,247,68,8,107,51,103,96,165,75,162,172,245,88,249,197,74,4,240,146,238,10,175,125,103,208,24,249,46,58,168,117,23,18,77,74,182,161,123,132,212,190,237,42,218,207,42,218,220,20,164,255,229,88,237,11,129,189,131,142,129,94,95,33,208,208,172,82,15,1,212,25,253,224,255,58,32,86,170,109,207,26,187,159,17,253,245,55,94,60,91,143,137,159,222,118,82,191,232,31,181,10,18,218,231,158,166,213,23,48,245,43,255,207,188,252,146,61,172,64,240,182,237,88,248,232,246,147,170,205,85,181,148,63,28,245,21,33,146,168,240,188,32,122,23,237,52,81,142,171,0,154,149,47,128,106,50,100,15,1,75,71,231,75,72,4,41,78,194,73,80,118,127,165,43,228,133,9,101,18,14,202,100,121,185,213,65,230,174,39,73,88,191,108,252,77,4,95,26,109,225,5,112,88,170,185,65,101,178,136,64,68,7,168,123,45,56,153,249,239,113,215,191,27,227,127,255,107,188,180,61,94,248,214,254,201,79,24,52,38,222,114,136,220,245,183,30,228,21,150,158,23,109,122,151,159,20,48,100,88,197,174,117,45,136,49,35,216,33,174,149,112,99,228,84,105,32)
  val bytes = data.map { it.toByte() }.toByteArray()

  val decompressor = SixpackDecompressor()
  val decompressed = decompressor.decompress(ByteBuffer.wrap(bytes))
  val decompressedUnsigned = decompressed.map { it.toInt() and 0xff }.joinToString(",")

  val foo = "bar"

  val compressor = SixpackCompressor()
  val compressed = compressor.compress(ByteBuffer.wrap(decompressed.toByteArray()))
  val compressedSigned = compressed.map { it.toInt() and 0xff }.joinToString(",")

  println(data.joinToString(","))
  println(compressedSigned)

  println("---")

  println("228,2,174,34,214,16,148,62,129,51,88,217,104,148,62,129,51,88,217,104,36,185,82,165,106,138,31,90,44,228,4,129,147,36,90,44,228,4,129,147,36,158,110,129,135,80,144,4,129,147,36,198,6,129,138,56,133,44,89,88,208,94,247,114,133,44,129,97,88,36,173,91,187,8,130,86,23,44,228,2,240,56,129,135,80,144,4,129,147,36,129,151,80,97,88,36,173,91,187,8,36,212,115,228,2,240,56,129,135,100,192,84,129,169,94,133,104,187,8,36,178,34,217,105,130,116,90,44,100,228,68,129,194,78,133,104,129,95,88,36,188,19,129,95,88,36,188,19,228,2,250,18,129,185,16,129,95,88,130,116,90,154,68,129,193,26,88,36,188,19,228,2,216,9,212,89,228,2,250,18,129,3,160,84,129,237,56,133,54,89,88,207,124,129,218,114,133,54,135,100,192,207,124,129,236,4,133,54,135,84,129,237,173,52,236,72,130,91,2,240,56,3,240,12,135,100,192,207,124,129,236,129,159,52,54,135,84,129,237,173,52,236,129,159,52,54,130,91,2,240,56,3,240,164,2,213,16,124,129,236,129,159,52,213,16,245,18,130,91,112,44,98,129,151,50,129,227,16,130,88,130,106,159,32,132,0,162,20,129,52,162,10,129,40,160,90,130,68,152,108,130,86,145,0,130,44,137,22,130,4,129,44,129,30,10,11,225,3,130,14,79,88,79,12,12,130,90,12,88,129,23,130,14,129,23,130,102,0,129,165,32,129,221,0,0,130,14,80,88,80,12,11,130,90,11,88,129,24,165,32,129,24,165,32,129,221,0,0,130,225,52,0,132,34,129,56,129,52,129,56,12,9,133,74,9,129,52,130,129,52,130,130,0,133,86,0,129,163,104,129,239,38,0,98,129,129,34,129,216,32,130,2,130,61,136,14,130,111,138,92,4,138,82,16,137,52,129,21,135,32,129,87,133,18,129,81,131,6,129,75,129,0,129,1,12,12,0,130,14,80,88,80,12,11,130,90,11,88,129,24,165,32,129,24,165,32,129,221,213,104,32,129,24,165,32,129,221,0,0,130,225,52,0,132,34,129,56,129,52,129,56,12,9,133,213,104,32,129,239,38,131,50,79,129,16,79,8,14,132,58,14,129,16,129,23,131,50,129,23,132,66,0,213,84,129,236,50,0,226,2,199,122,111,138,92,4,90,130,104,163,112,132,2,166,98,129,52,166,88,129,40,165,40,130,68,156,40,130,86,147,40,130,44,138,42,129,24,165,32,129,221,213,104,177,98,129,215,120,130,42,130,19,136,54,130,41,138,100,44,138,90,56,137,76,97,135,62,129,31,133,48,129,35,131,34,129,37,129,20,107,10,12,97,130,52,79,102,79,10,12,131,16,12,102,132,2,166,52,129,52,166,26,0,155,165,40,130,28,0,98,28,0,98,222,52,129,60,111,131,62,25,132,30,10,11,132,8,129,62,131,94,106,131,2,48,130,30,14,129,60,17,84,25,4,16,8,129,62,80,102,80,10,11,131,16,11,102,177,98,129,52,129,24,48,130,30,14,129,60,228,2,0,98,185,26,129,168,52,143,44,137,33,253,74,132,93,129,128,52,130,5,129,128,42,129,121,254,126,131,31,226,92,132,105,196,114,133,17,167,8,133,57,135,86,132,57,8,14,225,8,130,50,79,100,132,8,129,62,12,12,100,80,102,80,30,14,129,131,22,0,129,182,48,129,175,92,0,130,50,80,100,130,30,14,129,12,11,100,129,168,52,50,44,137,33,129,182,48,129,175,92,178,66,0,132,70,129,48,129,66,129,48,12,11,133,126,11,133,126,11,120,126,11,120,120,134,8,0,129,161,22,129,174,52,48,129,66,129,47,133,126,11,47,12,12,133,126,12,133,126,12,119,126,12,119,119,52,48,129,66,129,47,133,185,16,0,131,88,126,12,119,28,12,119,119,10,132,104,10,132,104,10,119,104,10,119,119,132,116,0,198,94,129,171,18,10,132,104,10,48,10,119,104,48,12,9,132,104,9,132,104,9,120,104,9,120,120,94,129,171,197,42,129,177,28,47,12,12,48,12,11,133,126,11,14,12,119,126,12,119,52,48,129,66,24,0,198,114,129,187,50,66,129,47,133,86,132,57,8,14,14,8,130,50,79,100,119,126,12,119,198,114,129,187,50,192,90,129,215,120,155,78,129,179,4,131,6,130,56,138,102,129,76,141,40,129,51,141,28,129,63,140,2,17,137,56,86,134,102,122,132,22,129,30,129,62,126,8,13,129,151,26,129,128,132,30,10,11,132,8,56,24,48,130,44,14,129,60,34,2,0,98,114,26,129,168,126,143,44,137,12,253,74,132,28,130,30,14,129,60,228,2,0,98,185,131,42,79,129,14,93,129,128,52,48,14,129,167,8,133,131,42,86,132,57,56,0,129,128,94,129,135,126,0,130,6,79,86,12,12,100,80,80,12,86,134,102,122,6,134,102,122,92,0,214,64,250,50,80,100,6,80,86,22,0,129,182,80,11,86,143,44,137,6,143,44,137,214,64,250,50,254,52,0,98,197,80,30,14,129,60,12,11,133,166,88,132,2,169,72,129,52,169,62,129,40,168,16,130,68,158,54,130,86,148,92,130,44,139,4,2,0,98,185,131,42,79,129,14,93,129,128,52,48,14,129,167,8,133,131,42,86,132,57,56,0,129,128,94,129,135,126,175,20,143,44,137,6,132,46,129,55,129,52,166,55,132,116,0,90,12,0,90,12,127,90,12,127,127,133,119,104,48,168,4,215,4,46,129,55,129,52,166,55,132,116,0,90,12,0,90,12,127,90,12,127,127,133,119,104,48,168,238,72,116,0,90,98,239,6,195,68,134,12,132,21,160,8,129,81,162,124,122,162,114,129,6,161,64,21,154,36,129,31,146,84,129,87,139,6,130,15,131,4,129,113,8,14,97,129,55,129,52,166,55,132,116,0,90,12,0,90,12,127,90,12,127,127,133,119,104,48,168,195,2,130,15,131,4,174,42,212,120,130,114,133,51,151,30,132,49,153,116,129,36,153,102,129,44,152,70,129,43,146,102,130,109,141,2,131,19,135,30,131,55,129,54,130,61,14,8,3,8,22,151,17,170,92,0,132,56,180,2,172,116,201,82,54,143,55,195,60,52,184,28,22,154,70,170,62,0,131,34,180,2,176,41,205,7,54,146,13,195,30,52,186,114,22,157,123,170,32,0,130,12,180,2,179,94,208,60,54,148,99,195,0,52,189,72,22,161,48,170,2,0,129,125,180,2,183,19,211,113,182,7,151,57,194,98,165,89,196,67,192,30,194,98,206,62,196,67,163,30,212,22,191,125,219,66,147,5,246,3,52,186,97,22,163,115,172,31,134,102,122,182,125,219,66,161,77,185,86,172,31,52,214,52,182,19,153,29,196,127,167,61,197,89,194,2,196,127,208,34,197,89,218,31,197,72,143,63,220,71,149,25,220,26,156,33,212,20,166,18,211,103,169,6,212,20,171,122,220,116,174,110,212,110,179,24,212,20,185,0,212,65,184,14,220,88,189,9,212,110,194,113,212,65,193,127,221,5,200,48,213,27,53,221,33,182,2,203,36,212,110,209,12,212,20,52,212,0,182,12,211,14,221,50,216,9,221,33,148,110,247,25,152,59,235,109,158,124,245,84,164,24,247,8,172,66,247,25,178,106,245,84,188,74,247,25,192,23,235,109,198,88,245,84,203,116,247,8,52,218,70,3,20,22,170,82,162,34,0,140,1,180,3,199,48,221,26,141,116,54,160,97,187,2,180,4,181,122,201,70,221,26,136,56,54,153,127,211,98,180,4,176,118,198,14,4,176,118,198,14,161,118,236,66,201,70,221,100,201,82,14,161,118,236,3,8,22,185,86,162,56,201,82,54,182,2,193,50,172,105,157,110,197,73,52,198,83,54,144,42,237,124,52,184,6,150,4,189,11,164,25,0,129,111,192,64,162,101,0,131,65,195,117,164,70,0,129,126,163,3,187,7,0,132,13,182,9,179,7,187,97,203,104,187,7,209,20,187,52,218,31,187,97,154,36,236,88,164,24,236,71,194,0,236,88,203,116,236,71,218,70,237,33,22,163,3,196,112,0,131,4,52,203,104,182,2,189,9,220,28,144,42,246,48,11,164,25,22,168,47,187,77,0,131,116,54,167,126,237,13,52,207,90,22,171,5,186,208,34,197,11,180,2,173,91,212,115,54,170,89,236,28,180,3,173,52,210,53,213,16,22,176,49,186,115,0,132,33,52,215,73,54,176,15,236,51,52,215,107,150,2,143,63,211,103,0,132,58,149,25,212,20,0,131,96,54,178,106,164,25,22,155,47,215,103,0,129,83,182,3,165,32,216,20,184,14,215,103,193,127,216,20,22,156,33,219,108,0,131,97,54,158,10,237,5,52,197,102,22,160,42,212,67,0,130,42,182,2,208,26,221,50,167,126,245,86,180,2,207,90,215,107,150,2,162,44,216,20,0,130,0,163,30,160,42,212,132,14,52,166,18,150,2,178,38,214,96,0,131,9,178,38,223,19,0,130,19,182,2,205,38,222,57,170,89,244,102,180,2,33,219,108,0,131,181,26,216,110,0,129,85,52,191,11,150,4,181,26,221,95,0,130,87,188,23,215,58,0,130,47,5,129,128,45,0,130,64,218,125,213,7,0,131,71,3,14,22,149,115,174,119,129,74,0,52,171,86,54,192,20,176,43,181,2,175,81,174,119,52,200,52,182,2,142,25,199,87,156,80,201,11,181,2,200,49,199,87,54,161,101,151,36,181,2,190,74,2,190,74,167,17,151,36,53,190,74,180,2,169,103,172,61,54,198,19,2,169,103,172,61,54,193,68,162,9,32,129,138,90,47,207,0,81,182,2,205,126,201,87,197,53,103,172,61,54,198,19,2,169,103,202,73,217,12,207,118,90,47,207,0,81,52,211,85,54,214,53,197,0,132,34,100,93,3,197,166,201,87,149,187,87,0,212,42,162,0,216,4,53,215,42,52,173,80,54,182,110,216,94,179,2,216,4,215,42,52,215,107,98,187,107,173,80,54,54,189,95,187,107,173,80,54,54,189,95,50,212,20,0,131,96,54,178,52,80,193,68,162,121,67,6,197,227,129,86,102,172,241,62,179,3,240,100,240,10,249,23,50,133,122,240,100,179,2,228,147,191,192,240,100,48,187,107,173,80,54,54,189,0,138,90,88,167,90,68,174,113,228,129,0,131,131,68,14,133,0,62,162,0,216,4,53,215,42,52,173,80,54,182,110,216,94,179,2,216,4,215,42,52,215,107,98,187,107,173,80,54,54,189,95,61,3,216,94,179,2,216,4,212,212,52,196,86,218,138,0,37,191,197,176,70,217,252,148,197,245,161,121,67,6,197,227,129,86,102,132,86,169,2,6,218,138,135,170,130,80,218,129,128,88,129,23,175,32,14,133,9,50,29,129,173,80,54,54,189,0,3,13,22,147,116,165,16,207,52,101,52,58,157,178,80,54,54,130,173,80,54,104,174,29,173,67,142,129,135,89,61,245,175,107,173,80,54,159,88,100,138,146,129,179,29,195,171,195,244,129,109,98,102,221,171,195,244,129,109,98,102,221,129,35,197,74,132,8,119,126,134,242,190,4,49,199,87,54,161,101,151,36,181,2,190,74,2,190,74,167,17,151,36,53,190,74,180,2,169,103,172,61,54,198,19,2,169,103,172,61,54,193,68,162,9,32,129,138,90,47,207,0,81,182,146,126,175,20,89,54,242,5,222,41,221,79,220,117,239,52,32,129,138,90,47,207,0,81,182,146,126,175,20,89,54,242,5,222,41,221,79,220,117,239,52,50,174,129,131,174,62,0,0,175,166,126,21,0,129,19,55,67,167,68,10,129,6,214,126,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,164,0,249,8,136,113,195,139,86,19,55,67,118,238,86,118,238,86,142,161,88,237,100,73,133,3,2,221,79,246,52,201,185,48,121,133,40,35,193,147,32,202,59,60,81,38,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,164,0,249,8,136,113,195,139,86,19,55,67,118,238,86,118,238,86,142,161,88,237,100,73,133,3,2,180,93,54,54,14,136,47,65,126,201,167,67,118,238,86,118,238,86,142,161,88,237,100,73,133,3,2,221,79,246,213,0,100,73,133,3,2,221,79,246,213,0,129,247,90,3,2,221,79,246,213,0,129,247,90,22,181,203,0,171,102,134,84,133,129,32,129,129,107,171,102,198,186,56,245,0,131,54,127,129,28,0,100,73,26,102,129,25,52,90,34,175,201,102,129,25,52,90,34,175,201,126,129,136,90,34,174,63,167,180,129,86,129,128,79,184,245,242,5,222,86,81,143,131,129,239,52,32,239,114,129,245,131,161,192,54,57,157,98,43,116,52,238,129,50,88,32,27,2,79,186,151,133,6,167,57,157,98,136,129,56,131,236,126,175,36,175,51,186,151,90,34,174,63,167,180,129,86,129,128,79,184,245,242,5,222,86,81,143,131,129,239,52,32,239,114,129,245,131,161,192,54,57,157,98,43,116,52,238,129,50,88,32,27,2,79,186,151,133,6,242,5,222,86,81,143,180,29,160,54,51,171,26,56,129,65,179,129,104,56,129,65,144,2,139,7,139,9,182,243,173,10,109,184,48,160,14,22,90,25,104,77,92,175,59,175,36,175,51,186,151,90,34,174,63,167,180,129,86,129,128,79,184,245,242,5,34,9,182,243,173,10,109,184,48,160,14,22,90,25,104,77,92,175,59,175,36,175,51,186,151,51,129,48,160,14,23,19,22,26,172,3,166,107,186,35,129,129,79,147,129,56,250,115,131,115,216,188,80,121,216,190,118,238,86,92,183,139,25,236,2,179,73,130,238,129,50,90,134,126,50,90,134,126,175,79,156,47,196,129,73,56,63,5,176,128,169,240,73,56,33,129,128,79,184,245,242,5,34,9,182,243,173,10,109,184,48,160,14,22,90,25,104,151,129,187,194,238,73,130,238,129,50,90,134,126,50,90,134,126,175,79,156,47,196,129,73,56,63,5,176,128,169,240,73,56,33,129,128,79,184,245,242,5,34,9,182,243,52,112,153,8,192,118,213,91,170,2,173,78,47,129,247,99,148,87,143,236,191,161,194,118,238,86,142,161,88,237,100,73,133,3,2,221,79,246,213,0,100,73,133,3,2,221,79,246,213,0,129,247,90,3,2,221,79,246,213,0,129,247,90,22,181,203,0,171,102,134,84,133,129,32,129,129,107,171,102,198,184,245,242,5,34,188,170,171,254,217,54,75,11,148,12,129,216,54,116,52,238,129,12,94,151,185,3,2,221,79,246,213,212,14,197,99,134,126,175,197,99,217,38,195,53,213,135,123,148,79,176,2,129,161,176,88,49,129,212,87,221,124,228,61,131,135,123,148,201,105,83,128,191,215,129,63,88,3,216,4,221,124,228,148,146,138,165,100,129,127,56,112,160,73,115,11,195,26,167,81,138,169,155,62,161,182,2,205,104,31,153,120,26,187,143,88,23,175,189,182,36,198,107,50,184,6,11,148,12,169,200,212,87,220,19,22,26,172,3,166,107,186,35,227,215,31,227,215,31,33,11,151,198,148,44,237,2,87,252,212,87,221,124,228,61,131,135,123,148,201,105,83,128,191,215,129,63,88,3,216,158,175,199,19,84,44,215,129,63,88,3,216,4,221,124,228,148,146,138,165,100,129,127,56,112,160,73,115,11,195,26,167,81,138,169,155,62,161,182,195,9,71,78,52,94,134,105,202,47,90,147,2,90,194,169,47,221,34,50,212,86,129,117,197,131,196,87,220,19,190,182,50,218,5,216,1,0,131,71,3,240,34,103,124,228,148,146,138,165,100,129,127,56,112,160,73,115,11,195,26,167,81,138,169,155,62,161,182,195,9,71,78,52,94,134,105,202,47,90,147,2,90,194,169,47,221,34,50,212,86,129,117,197,131,196,87,160,122,213,161,74,2,105,83,146,26,160,122,213,161,74,2,105,83,146,26,56,127,154,253,89,191,212,86,129,220,168,73,133,3,2,221,79,246,213,0,129,247,90,3,2,221,79,246,213,0,129,247,90,22,181,203,0,171,102,134,84,133,129,32,129,129,107,171,102,198,184,245,242,5,34,188,170,171,254,217,54,182,25,250,129,19,105,56,88,253,3,72,16,50,161,129,50,189,126,88,70,12,100,161,129,50,189,126,88,70,12,100,180,253,148,152,189,175,247,47,161,40,81,138,169,255,81,196,44,52,50,6,30,14,65,253,148,152,2,237,161,239,9,48,240,100,50,193,23,81,196,44,52,50,6,30,132,25,135,129,132,25,135,132,162,22,185,34,196,116,56,196,56,196,116,56,196,56,162,173,131,206,205,182,129,132,195,129,2,54,120,209,129,215,191,129,212,196,56,162,173,131,128,52,192,182,129,132,195,129,2,37,192,48,205,85,191,129,212,196,56,162,132,53,217,80,205,129,50,189,126,88,70,12,100,161,129,50,189,126,88,70,12,100,180,253,148,152,197,169,160,142,129,135,89,61,245,175,107,173,80,54,159,88,100,138,146,129,179,29,195,171,195,244,129,109,98,102,221,171,195,244,129,109,98,102,221,129,35,197,74,132,8,119,126,134,242,190,4,49,199,87,54,161,101,151,36,181,2,190,74,2,80,146,240,114,117,131,169,166,54,143,166,54,143,136,148,180,150,26,157,129,58,121,172,20,109,184,105,84,191,47,142,169,166,108,217,90,218,106,44,211,129,179,29,195,171,130,100,199,218,54,132,86,72,52,161,131,174,130,100,188,129,35,197,74,132,8,166,151,86,194,63,77,129,20,109,184,12,151,182,42,54,195,214,247,3,167,9,172,12,165,113,153,130,131,0,131,169,166,88,155,129,228,115,179,29,195,171,160,42,163,20,129,129,195,70,89,74,132,8,166,151,86,115,131,110,195,171,160,42,111,0,131,169,166,88,131,169,166,68,14,50,197,191,133,16,50,161,129,50,189,126,88,70,12,100,161,129,50,189,126,88,70,12,100,180,253,148,152,189,175,247,47,139,100,129,151,162,182,44,9,182,54,199,166,143,62,126,165,3,134,221,34,0,0,129,247,50,129,253,148,152,189,175,247,47,139,100,129,151,162,182,44,9,182,54,199,166,143,62,126,165,3,134,221,81,187,89,74,132,8,166,151,86,115,131,110,195,171,160,42,111,0,131,169,166,88,131,169,166,68,191,187,89,74,220,73,138,38,116,129,23,170,129,196,130,118,129,11,243,227,129,167,68,154,197,143,62,126,165,81,13,2,199,129,212,78,113,148,139,16,17,129,85,11,192,182,129,153,185,108,50,20,65,169,129,167,68,154,81,148,196,50,136,23,177,92,122,161,19,255,86,133,26,74,134,129,153,179,6,155,174,182,155,199,181,2,190,41,133,71,5,129,13,245,90,216,247,207,160,28,146,148,80,121,129,87,129,66,34,0,6,126,7,182,30,185,126,202,51,84,113,52,132,28,127,105,86,138,225,0,141,16,131,137,160,65,2,132,105,181,99,97,54,3,55,85,98,62,0,109,182,5,80,16,66,27,39,162,181,26,88,169,129,168,58,184,16,161,136,29,58,159,80,160,162,53,19,99,62,196,171,52,27,142,245,130,42,146,49,143,154,129,67,58,46,148,54,133,162,129,5,245,88,135,181,102,166,16,163,228,129,207,160,28,6,192,131,103,49,49,50,71,6,147,104,30,163,253,245,151,133,66,80,162,2,132,105,49,79,86,186,23,49,49,50,71,6,147,104,30,163,40,105,151,1,71,172,1,71,172,130,139,100,129,148,160,92,169,166,68,14,50,197,191,133,16,50,161,129,50,189,66,3,139,0,52,212,168,196,129,167,88,94,19,0,16,131,137,160,65,2,132,105,181,99,97,54,3,55,85,98,62,0,109,182,5,12,16,163,228,129,207,160,28,6,192,131,103,49,49,50,71,6,147,104,30,163,253,245,151,133,66,80,162,2,132,105,151,0,0,129,247,50,129,253,148,152,189,175,247,47,139,100,129,151,162,182,44,9,182,54,199,166,143,62,126,165,3,134,221,81,187,89,74,132,8,166,245,49,49,50,147,169,86,129,253,245,151,133,66,80,162,2,132,105,151,0,0,129,247,50,129,253,148,152,189,175,247,47,139,100,129,151,162,182,44,9,182,54,199,166,143,62,126,165,3,134,52,247,50,129,253,148,152,227,198,131,129,54,22,50,129,253,51,147,31,45,178,12,3,2,221,79,246,213,0,129,247,90,3,2,221,79,98,58,83,141,227,170,90,175,188,31,0,0,129,247,50,129,253,148,152,189,175,247,47,139,100,129,151,162,182,44,9,182,54,199,166,143,62,126,165,3,134,52,247,50,129,253,148,152,227,198,131,129,54,22,50,129,253,51,147,31,45,178,12,3,132,134,167,129,110,125,162,162,56,128,148,128,201,174,160,28,6,78,79,98,58,44,128,85,116,102,178,12,3,132,134,167,0,151,200,163,88,191,194,2,166,135,117,79,44,176,133,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,116,101,170,170,129,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,178,12,126,213,116,101,170,170,129,189,200,218,101,66,0,0,0,121,90,130,189,129,216,130,236,3,0,247,48,131,0,0,0,0,127,126,129,0,25,53,62,201,55,159,107,74,183,40,138,86,143,54,130,168,65,101,170,170,130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,182,0,4,182,0,4,131,98,0,0,0,136,6,39,129,3,133,131,54,172,0,0,0,0,0,182,0,4,182,183,115,201,200,71,133,88,167,115,87,90,161,3,36,52,55,159,107,74,153,127,100,79,206,56,32,126,252,131,200,167,161,3,36,52,178,32,197,253,220,129,197,0,218,38,42,70,147,197,55,159,107,74,183,40,138,86,143,54,130,168,65,101,170,170,130,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,129,2,2,130,246,42,114,178,0,154,161,151,4,182,183,115,201,200,71,133,88,167,115,87,90,161,3,36,52,55,159,107,74,110,138,131,47,48,128,216,176,80,2,114,135,32,126,148,129,138,188,81,239,126,44,190,105,90,128,80,130,3,36,52,178,32,130,134,114,135,32,126,148,129,161,151,4,182,183,115,201,200,71,133,88,167,115,87,90,161,3,36,52,55,159,107,74,110,138,131,47,48,128,216,176,80,2,114,135,32,126,148,129,138,188,81,239,126,44,190,105,90,128,80,130,3,36,52,178,32,130,134,114,135,32,126,148,83,89,94,19,49,85,244,57,240,50,146,6,26,143,147,73,145,129,26,86,140,165,198,239,2,186,36,131,240,148,87,103,30,190,20,112,213,13,4,32,40,130,226,12,100,180,169,88,151,12,217,2,250,215,227,162,169,129,26,86,140,165,198,239,2,186,36,131,240,148,87,103,30,190,20,112,213,13,4,32,40,130,80,146,240")
  println(decompressor.decompress(ByteBuffer.wrap(compressed.toByteArray())).map { it.toInt() and 0xff }.joinToString(","))

  val bar = "baz"
}
